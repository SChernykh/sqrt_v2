#pragma once

#include <stdint.h>

static const uint32_t SqrtV2TableSmall[384] = {
	0x1ff8040eu,0xff805fc0u,0xfd8fe823u,0x5fb86b47u,0xfe8357a0u,0xf8afb90fu,0x9f39ee0bu,0xfd8939a0u,
	0xf3ff8ae2u,0xde7d450eu,0xfc91f760u,0xef5f5d95u,0x1d832587u,0xfb9d8301u,0xeadf3123u,0x5c4c4140u,
	0xfaabcf21u,0xe67f0585u,0x9ad946b3u,0xf9bccea1u,0xe23edab6u,0xd92ae11bu,0xf8d074a1u,0xde1eb0b1u,
	0x1741b88cu,0xf7e6b4e2u,0xda0e8771u,0x551e720au,0xf6ff8302u,0xd61e5ef1u,0x92c1af97u,0xf61ad362u,
	0xd23e372bu,0xd02c104bu,0xf5389a62u,0xce7e101bu,0xd5e3065u,0xf458ccc3u,0xcadde9bdu,0x4a58a95fu,
	0xf37b5fa3u,0xc74dc40du,0x871c11fdu,0xf2a04823u,0xc3cd9f05u,0xc3a8fe5fu,0xf1c77c03u,0xc06d7aa2u,
	0x10u,0xf0f0f104u,0xbd1d56e0u,0x3c21a61bu,0xf01c9d24u,0xb9dd33bbu,0x780e7d14u,0xef4a76c4u,
	0xb6bd112fu,0xb3c70f2bu,0xee7a7484u,0xb39cef39u,0xef4be439u,0xedac8d04u,0xb09ccdd5u,0x2a9d81ceu,
	0xece0b745u,0xadacad00u,0x65bc6b42u,0xec16ea85u,0xaacc8cb6u,0xa0a921bbu,0xeb4f1e05u,0xa80c6cf4u,
	0xdb642442u,0xea894985u,0xa54c4db8u,0x15edefcau,0xe9c564a6u,0xa29c2efdu,0x5046ff3eu,0xe9036786u,
	0x9ffc10c2u,0x8a6fcb8cu,0xe8434a46u,0x9d6bf302u,0xc468cbb3u,0xe7850506u,0x9aebd5bcu,0xfe3274cbu,
	0xe6c89086u,0x987bb8edu,0x37cd3a11u,0xe60de547u,0x961b9c92u,0x71398cf1u,0xe554fc27u,0x93bb80a9u,
	0xaa77dd11u,0xe49dce27u,0x916b652fu,0xe388985au,0xe3e85467u,0x8f3b4a21u,0x1c6c2b04u,0xe3348808u,
	0x8d0b2f7eu,0x5522ff9au,0xe28262a8u,0x8adb1543u,0x8dad7f0au,0xe1d1ddc8u,0x88cafb6eu,0xc60c10a9u,
	0xe122f308u,0x86bae1fdu,0xfe3f1a3cu,0xe0759c68u,0x84bac8edu,0x36470003u,0xdfc9d3a9u,0x82bab03du,
	0x6e2424beu,0xdf1f9309u,0x80ca97ebu,0xa5d6e9b9u,0xde76d4c9u,0x7eea7ff4u,0xdd5faeceu,0xddcf9309u,
	0x7d0a6857u,0x14bed273u,0xdd29c84au,0x7b3a5112u,0x4bf4b1bau,0xdc856f2au,0x797a3a23u,0x8301a85fu,
	0xdbe2824au,0x77ba2389u,0xb9e610cdu,0xdb40fc8au,0x760a0d41u,0xf0a24421u,0xdaa0d8aau,0x7459f74bu,
	0x27369a35u,0xda0211cbu,0x72b9e1a4u,0x5da369a5u,0xd964a2cbu,0x7119cc4bu,0x93e907d4u,0xd8c886ebu,
	0x6f89b73fu,0xca07c8f6u,0xd82db98bu,0x6df9a27du,0x10u,0xd79435ecu,0x6c798e05u,0x35d1ff03u,
	0xd6fbf78cu,0x6af979d5u,0x6b7e168fu,0xd664f9ecu,0x697965ecu,0xa1049658u,0xd5cf38ccu,0x68195248u,
	0xd665ccf0u,0xd53aafacu,0x66a93ee8u,0xba207d6u,0xd4a75a8du,0x65492bcbu,0x40b9937du,0xd415350du,
	0x63e918f0u,0x75acbb56u,0xd3843b6du,0x62990654u,0xaa7bc9ceu,0xd2f4696du,0x6148f3f8u,0xdf270855u,
	0xd265bb4du,0x6008e1dau,0x13aebf66u,0xd1d82d0eu,0x5ec8cff8u,0x48133686u,0xd14bbb0eu,0x5d88be53u,
	0x7c54b44du,0xd0c061aeu,0x5c58ace7u,0xb0737e69u,0xd0361d2eu,0x5b289bb6u,0xe46fd9a0u,0xcface9eeu,
	0x59f88abcu,0x184a09d7u,0xcf24c48fu,0x58d879fbu,0x4c025215u,0xce9da98fu,0x57b86970u,0x7f98f488u,
	0xce1795afu,0x5698591au,0xb30e3286u,0xcd92856fu,0x558848f9u,0xe6624c93u,0xcd0e758fu,0x5478390cu,
	0x19958265u,0xcc8b6310u,0x53682951u,0x4ca812e7u,0xcc094a90u,0x525819c8u,0x7f9a3c3cu,0xcb882910u,
	0x51580a71u,0xb26c3bc2u,0xcb07fb90u,0x5057fb49u,0xe51e4e18u,0xca88bf10u,0x4f67ec51u,0x17b0af1eu,
	0xca0a70b1u,0x4e67dd88u,0x4a2399fau,0xc98d0d51u,0x4d77ceecu,0x7c77491cu,0xc9109251u,0x4c87c07du,
	0xaeabf63fu,0xc894fcf1u,0x4ba7b23au,0xe0c1da6du,0xc81a4a31u,0x4ab7a423u,0x12b92e03u,0xc7a077b2u,
	0x49d79637u,0x449228b1u,0xc7278292u,0x48f78875u,0x764d0180u,0xc6af6852u,0x48177adcu,0xa7e9eed3u,
	0xc6382652u,0x47476d6cu,0xd969266au,0xc5c1ba12u,0x46776024u,0xacadd66u,0xc54c2113u,0x45a75304u,
	0x3c0f4849u,0xc4d758d3u,0x44d7460au,0x6d369afbu,0xc4635f13u,0x44073936u,0x9e4108cau,0xc3f03153u,
	0x43472c88u,0xcf2ec46fu,0xc37dcd53u,0x42871fffu,0x10u,0xc30c30d4u,0x41c7139au,0x30b4ed40u,
	0xc29b5974u,0x41070759u,0x614dbd03u,0xc22b4514u,0x4046fb3bu,0x91ca9fd1u,0xc1bbf174u,0x3f96ef40u,
	0xc22bc598u,0xc14d5c74u,0x3ed6e367u,0xf2715dbcu,0xc0df8414u,0x3e26d7afu,0x229b971bu,0xc07265f5u,
	0x3d76cc19u,0x52aaa010u,0xc0060055u,0x3cd6c0a3u,0x829ea671u,0xbf9a5115u,0x3c26b54du,0xb277d798u,
	0xbf2f5635u,0x3b86aa17u,0xe236605cu,0xbec50db5u,0x3ad69effu,0x11da6d1bu,0xbe5b75b6u,0x3a369407u,
	0x416429b6u,0xbdf28c56u,0x3996892du,0x70d3c198u,0xbd8a4f96u,0x38f67e70u,0xa0295fb3u,0xbd22bdb6u,
	0x386673d0u,0xcf652e85u,0xbcbbd4f6u,0x37c6694eu,0xfe875819u,0xbc559376u,0x37365ee8u,0x2d900606u,
	0xbbeff777u,0x3696549eu,0x5c7f6175u,0xbb8aff57u,0x36064a6fu,0x8b559321u,0xbb26a917u,0x3576405cu,
	0xba12c358u,0xbac2f357u,0x34e63663u,0xe8b719fcu,0xba5fdc37u,0x34662c85u,0x1742be85u,0xb9fd6238u,
	0x33d622c1u,0x45b5d805u,0xb99b83b8u,0x33561916u,0x74108d26u,0xb93a3ef8u,0x32c60f85u,0xa253042du,
	0xb8d99298u,0x3246060du,0xd07d62fbu,0xb8797cf8u,0x31c5fcadu,0xfe8fcf11u,0xb819fc98u,0x3145f365u,
	0x2c8a6d8bu,0xb7bb0ff9u,0x30c5ea36u,0x5a6d6329u,0xb75cb579u,0x3045e11du,0x8838d44cu,0xb6feebd9u,
	0x2fc5d81cu,0xb5ece4f8u,0xb6a1b179u,0x2f55cf32u,0xe389b8d4u,0xb6450519u,0x2ed5c65fu,0x110f732fu,
	0xb5e8e53au,0x2e65bda2u,0x3e7e36feu,0xb58d507au,0x2df5b4fau,0x6bd626ddu,0xb532459au,0x2d85ac69u,
};

#ifdef __GNUC__
#define FORCEINLINE __attribute__((always_inline)) inline
#else
#define FORCEINLINE __forceinline
#endif

#pragma pack(push, 1)
struct SqrtV2SmallLUT
{
	uint64_t c0 : 37;
	uint64_t c1 : 27;
	uint32_t c2 : 20;
	uint32_t c3 : 12;

	static FORCEINLINE uint64_t get(const uint64_t n)
	{
		const SqrtV2SmallLUT& r = ((SqrtV2SmallLUT*)SqrtV2TableSmall)[n >> 57];
		uint64_t x = r.c0;

		const int64_t index1 = static_cast<int64_t>((n >> 25) & 4294967295) - 2147483648;

		const uint64_t index2 = static_cast<uint64_t>(index1 * index1) >> 31;
		const int64_t c1 = (static_cast<int64_t>(r.c1) * index1) >> 29;

		const int64_t index3 = static_cast<int64_t>(index2 * index1) >> 31;
		const uint64_t c2 = (static_cast<uint64_t>(r.c2) * index2) >> 32;

		x += c1 - c2;

		const int64_t c3 = (static_cast<int64_t>(r.c3) * index3) >> 33;

		x += c3;
		x >>= 5;

		const uint64_t s = x >> 1;
		const uint64_t b = x & 1;
		return x - (static_cast<uint64_t>(n - (s * (s + b) + (x << 32) + b)) >> 63);
	}
};
#pragma pack(pop)

static_assert(sizeof(SqrtV2SmallLUT) == 12, "SqrtV2SmallLUT must be 12 bytes in size, check your compiler options");
